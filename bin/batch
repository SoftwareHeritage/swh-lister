#!/bin/bash

# Copyright (C) 2015  Stefano Zacchiroli <zack@upsilon.cc>
# License: GNU General Public License version 3, or any later version
# See top-level LICENSE file for more information

PROXY="127.0.0.1:8118"  # use Tor

BATCH_NO="$1"
shift
if [ -z "$BATCH_NO" ] ; then
    echo "Usage: batch MILLION_NO [MIN_ID]"
    exit 2
fi

MIN_ID="$1"
shift

export https_proxy=$PROXY
export PYTHONPATH=`pwd`

min_id=$[ ($BATCH_NO - 1) * 1000000 + 1 ]
max_id=$[ $BATCH_NO * 1000000 ]

# allow min_id override on the command line
if [ -n "$MIN_ID" ] ; then
    min_id=$[ $MIN_ID > $min_id ? $MIN_ID : $min_id ]
fi

cmd="bin/ghlister list ${min_id}-${max_id}"
echo Running $cmd ...
$cmd
